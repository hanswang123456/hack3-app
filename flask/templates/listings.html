<!DOCTYPE html>
<html>
  <head>
    <title>HTML</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="{{url_for('static', filename ='css/listings.css')}}"
    />
  </head>
  <header>
    <div class="logo">What 2 Watch</div>
    <button class="home-button" onclick="go_home()">Home</button>
  </header>
  <body>
    <div class="recommendations">
      <h1 class="recommendations_header">Top Site(s)</h1>
      <div id="top-site-list"></div>
    </div>
    <div class="recommendations">
      <h1 class="recommendations_header">Recommendations</h1>
      <div id="recommendation_list"></div>
    </div>
  </body>
  <script>
    function go_home() {
      window.location = "/";
    }

    var scrapeData = "{{data}}";
    var posterData = "{{posters}}";
    posterData = posterData.replaceAll("&#39;", "");
    posterData = posterData.replaceAll("[", "");
    posterData = posterData.replaceAll("]", "");

    scrapeData = scrapeData.replaceAll("&#39;", "");
    scrapeData = scrapeData.replaceAll("[", "");
    scrapeData = scrapeData.replaceAll("]", "");
    scrapeData = scrapeData.replaceAll(" '' ", "");

    var urlData = "{{links}}";
    urlData = urlData.replaceAll("&#39;", "");
    urlData = urlData.replaceAll("[", "");
    urlData = urlData.replaceAll("]", "");

    const info = scrapeData.split(", ");
    const urls = urlData.split(", ");
    const posters = posterData.split(",");
    console.log(posters);

    const root = document.getElementById("recommendation_list");
    const urlRoot = document.getElementById("top-site-list");
    for (let i = 0; i < urls.length; i++) {
      var sitename = new URL(urls[i]);
      sitename = sitename.hostname;
      console.log(sitename);
      var elementBox = document.createElement("div");
      elementBox.className = "url-card";
      elementBox.innerHTML =
        '<div class="url-card">' +
        '<a href="' +
        urls[i] +
        '">' +
        '<h3 class="card_header" style = "margin-left:20px">' +
        sitename +
        "</h3></a>" +
        "</div>";

      urlRoot.appendChild(elementBox);
    }

    for (let i = 0; i < info.length; i++) {
      if (i >= 12) {
        break;
      }
      //split the current element from the dashes to make name and description
      var currentInfo = info[i].split(" â€” ");
      var elementBox = document.createElement("div");
      elementBox.className = "card";
      elementBox.innerHTML =
        '<div class="card" data-redirect="#">' +
        '<img class="card_image" src=' +
        posters[i] +
        ' alt="An image of the actual movie"/>' +
        '<div class="card_info">' +
        '<h3 class="card_header">' +
        currentInfo[0] +
        "</h3>" +
        '<p class="card_description">' +
        currentInfo[1] +
        "</p></div> </div>";
      root.appendChild(elementBox);
    }
  </script>
</html>
